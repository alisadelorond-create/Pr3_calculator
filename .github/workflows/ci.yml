name: CI/CD with Self-Hosted Runner

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        python -m pytest -v

  deploy:
    runs-on: self-hosted  # â† Ğ’ĞĞ–ĞĞ: self-hosted!
    needs: test
    
    steps:
    - name: Checkout code on production
      uses: actions/checkout@v3
    
    - name: Setup Python on production
      run: |
        python3 --version
        pip3 install -r requirements.txt
    
    - name: Deploy application to production
      run: |
        echo "ğŸš€ STARTING DEPLOYMENT TO PRODUCTION SERVER..."
        echo "ğŸ“ Current directory: $(pwd)"
        echo "ğŸ‘¤ User: $(whoami)"
        echo "ğŸ’» Hostname: $(hostname)"
        
        DEPLOY_PATH="$HOME/calculator-production"
        echo "ğŸ“¦ Deploying to: $DEPLOY_PATH"
        
        mkdir -p $DEPLOY_PATH
        cp -r *.py requirements.txt *.txt $DEPLOY_PATH/
        
        echo "âœ… Files deployed:"
        ls -la $DEPLOY_PATH/
        
        echo "ğŸ§ª Testing deployed application..."
        cd $DEPLOY_PATH
        python3 -c "
from calculator import add, subtract, multiply, divide
print('ğŸ‰ PRODUCTION DEPLOYMENT SUCCESSFUL!')
print('2 + 3 =', add(2, 3))
print('5 - 2 =', subtract(5, 2))
print('4 * 3 =', multiply(4, 3))
print('6 / 2 =', divide(6, 2))
print('ğŸš€ Application ready for use!')
"
        
        echo "ğŸ“‹ Deployment completed at: $(date)"