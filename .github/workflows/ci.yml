name: CI/CD with Self-Hosted Runner

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        python -m pytest -v

  deploy:
    runs-on: self-hosted
    needs: test
    
    steps:
    - name: Checkout code on production
      uses: actions/checkout@v3
    
    - name: Setup Python on production
      run: |
        python3 --version
        pip3 install -r requirements.txt
    
    - name: Deploy application to production
      run: |
        echo "🚀 STARTING DEPLOYMENT TO PRODUCTION SERVER..."
        echo "📁 Current directory: \C:\Users\LisaFox\OneDrive\Рабочий стол\ТВПО\pr3-calculator"
        echo "👤 User: \laptop-f456npeo\lisafox"
        echo "💻 Hostname: \LAPTOP-F456NPEO"
        
        DEPLOY_PATH=\"\C:\Users\LisaFox/calculator-production\"
        echo "📦 Deploying to: \"
        
        mkdir -p \
        cp -r *.py requirements.txt *.txt \/
        
        echo "✅ Files deployed:"
        ls -la \/
        
        echo "🧪 Testing deployed application..."
        cd \
        python3 -c \"
from calculator import add, subtract, multiply, divide
print('🎉 PRODUCTION DEPLOYMENT SUCCESSFUL!')
print('2 + 3 =', add(2, 3))
print('5 - 2 =', subtract(5, 2))
print('4 * 3 =', multiply(4, 3))
print('6 / 2 =', divide(6, 2))
print('🚀 Application ready for use!')
\"
        
        echo "📋 Deployment completed at: \11/12/2025 08:27:06"
